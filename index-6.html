<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>Google 시트 뷰어 · 1분 자동 새로고침</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!--
      GitHub Pages 업로드용 단일 파일(index.html)
      - 아래 SHEET_ID만 바꾸면 다른 문서에도 사용 가능
      - 특정 탭을 고정하려면 URL 뒤에 #gid=숫자 를 붙이세요
        예) https://docs.google.com/.../preview#gid=123456789
    -->
    <style>
      html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        overflow: hidden;
        background: #000;
      }
      #frame {
        width: 100%;
        height: 100%;
        border: 0;
        background: #111;
      }
      #status {
        position: fixed;
        right: 8px;
        bottom: 8px;
        padding: 6px 10px;
        border-radius: 8px;
        font: 12px/1.35 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial;
        color: #ddd;
        background: rgba(0,0,0,.45);
        user-select: none;
        pointer-events: none;
      }
      a#open {
        position: fixed;
        left: 8px;
        bottom: 8px;
        padding: 6px 10px;
        border-radius: 8px;
        font: 12px/1.35 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial;
        color: #ddd;
        background: rgba(0,0,0,.3);
        text-decoration: none;
      }
    </style>
  </head>
  <body>
    <iframe id="frame"
      src="https://docs.google.com/spreadsheets/d/1ELGd0SQnMaR3M5L1tcmrA3iQi37eiWuxXEs4l7qnS-0/preview"
      allowfullscreen
      loading="lazy"
      referrerpolicy="no-referrer-when-downgrade">
    </iframe>
    <div id="status">로딩 중…</div>
    <a id="open" target="_blank" rel="noopener">원본 열기</a>

    <script>
      (function() {
        const SHEET_ID = "1ELGd0SQnMaR3M5L1tcmrA3iQi37eiWuxXEs4l7qnS-0";
        const BASE = "https://docs.google.com/spreadsheets/d/" + SHEET_ID + "/preview";
        const frame = document.getElementById("frame");
        const statusEl = document.getElementById("status");
        const openBtn = document.getElementById("open");
        const INTERVAL = 60 * 1000; // 1분
        const FIRST_DELAY = 5000;   // 초기 안정 로딩 대기

        function setStatus(msg) {
          statusEl.textContent = msg;
        }

        function currentBaseWithGid() {
          // 주소 해시(#gid=...)가 있으면 preview URL 뒤에 그대로 붙인다.
          const h = location.hash || "";
          return BASE + h;
        }

        function cacheBusted(url) {
          return url + (url.includes("?") ? "&" : "?") + "t=" + Date.now();
        }

        function refresh() {
          const url = cacheBusted(currentBaseWithGid());
          frame.src = url;
          setStatus("새로고침: " + new Date().toLocaleTimeString());
          // 원본 열기 버튼 링크도 동일 탭으로 설정
          openBtn.href = "https://docs.google.com/spreadsheets/d/" + SHEET_ID + "/edit";
        }

        // 탭 비활성화 시 새로고침 일시 중지
        let timer = null;
        document.addEventListener("visibilitychange", function() {
          if (document.hidden) {
            if (timer) { clearInterval(timer); timer = null; setStatus("일시정지(탭 비활성화)"); }
          } else {
            refresh();
            if (!timer) { timer = setInterval(refresh, INTERVAL); }
          }
        });

        // iframe 로드 상태 표시
        frame.addEventListener("load", function() {
          setStatus("표시 중 — " + new Date().toLocaleTimeString());
        });

        // 초기 설정
        openBtn.href = "https://docs.google.com/spreadsheets/d/" + SHEET_ID + "/edit";
        // 첫 로딩은 안정적으로 표시 후, 일정 시간 뒤부터 주기 시작
        setTimeout(function() {
          refresh();
          timer = setInterval(refresh, INTERVAL);
        }, FIRST_DELAY);
      })();
    </script>
  </body>
</html>
